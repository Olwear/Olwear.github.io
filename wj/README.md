# 微机原理

计算机主要发展阶段

* 电子管计算机
* 晶体管计算机
* 集成电路计算机
* 大规模集成电路计算机
* 人工智能计算机

微型计算机的主要发展阶段

* 低档8位微处理器和微型计算机
* 中档8位微处理器和微型计算机
* 16位微处理器和微型计算机
* 32位微处理器和微型计算机

BCD码4位表示一个十进制

负数计算需要转补码

微型计算机系统的性能指标

* 字长
* 存储器容量
* 运算速度
* 扩展能力
* 软件配置情况

***

8086微处理器内部结构

* 总线接口部件（BUI）

  > 负责8086微处理器与存储器和外设之间的信息传递

  * 地址加法器和段寄存器
    > 由于8086微处理器具有20位地址总线，可以方便地寻址2^20=1MB地内存单元
  * 指令队列缓存器
    > 6字节地“先进先出”RAM存储器，用来按顺序存放CPU要执行的指令，并送到EU中去执行
  * 总线控制电路
    > 负责生产总线控制信号
* 执行部件（EU）
  > 负责指令地执行
  
  * 算术逻辑单元（ALU）
    > 用来对操作数进行算数运算和逻辑运算，也可以按指令的寻址方式计算出CPU要访问的内存单元的16位偏移地址
  * 数据暂存寄存器
    > 暂时保存数据，并向ALU提供参与运算的操作数
  * EU控制电路
    > 接受从BIU指令队列中取出的指令代码，经过分析、译码后形成各种实时控制信号，对各个部件进行实时操作

80486微处理器内部结构

* 总线接口部件（BIU）
* 指令预取部件
* 指令译码部件（IDU）
* 控制和保护测试部件（CPTU）
* 整数执行部件（IU）
* 浮点运算部件（FPU）
* 分段部件（SU）和分页部件（PU）
* 高速缓冲存储器部件（CU）

8086微处理器的寄存器

* 通用寄存器
* 指针及变址寄存器
  * 指针寄存器
  * 变址寄存器
* 段寄存器
* 指令指针
* 标志寄存器
  * 状态标志位
    * 进位标志（CF）
    * 奇偶校验标志（PF）
    * 辅助进位标志（AF）
    * 零标志（ZF）
    * 符号标志（SF）
    * 溢出标志（OF）
  * 控制标志位
    * 方向标志（DF）
    * 中断允许标志（IF）
    * 单步标志（TF）

80486微处理器的寄存器

* 基本寄存器
* 通用寄存器（GPR）
* 指令指针寄存器（EIP）
* 标志寄存器（EFR)
  * 状态标志位
    * 进位标志（CF）
    * 奇偶标志（PF）
    * 辅助进位标志（AF）
    * 零标志（ZF）
    * 符号标志（SF）
    * 溢出标志（OF）
  * 控制标志位
    * 陷阱标志/单步操作标志（TF）
    * 中断标志（IF）
    * 方向标志（DF）
    * 输入/输出特权级标志位（IOPL）
    * 任务嵌套标志（NT）
    * 恢复标志（RF）
    * 虚拟8086模式标志（VM）
    * 队列检查标志（AC）
  * 段寄存器（SR）
    * 代码段寄存器（CS）
    * 数据段寄存器（DS）
    * 堆栈段寄存器（SS）
      > 堆栈指针寄存器（ESP）
    * 附加段寄存器（ES）
    * 附加段寄存器（FS和GS）
* 系统寄存器
  * 系统地址寄存器
    * GDTR
    * IDTR
    * LDTR
    * TR
  * 控制寄存器（CR）
    * 控制寄存器（CR0）
      * 保护模式允许位（PE）
      * 监视协处理器位（MP）
      * 仿真协处理器（EM）
      * 任务转换位（TS）
      * 协处理器类型标志（ET）
      * 数据异常位（NE）
      * 写保护（WP）
      * 对齐标志位（AM）
      * 不通写位（NW）
      * 允许Cache位（CD）
      * 允许分页位（PG）
    * 控制寄存器（CR3)
      * 页级通写位（PWT）
      * 禁止页高速缓冲位（PCD）
    * 调试寄存器和测试寄存器
      * 调试寄存器（DR）
        * 调试寄存器（DR7）
          * 局部断点使能标志位（L3~L0）
          * 全局断点使能标志位（G3~G0）
          * 局部断点、全局断点类型标志位（LE和GE）
          * 调试寄存器保护标志位（GD）
          * 发生中断时系统读/写标志位（R/W3~R/W0）
          * 断点地址存放的数据长度（LEN3~LEN0）
        * 调试状态寄存器（DR6）
          * 断点异常发生指示位（B3~B0）
          * 调试寄存器处理检查位（BD）
          * 单步异常标志位（BS）
          * 任务转换标志位（BT）
      * 测试寄存器（TR）
    * 浮点寄存器

存储器为什么要分段
> 8086CPU有20条地址线，可直接寻址1M字节的存储空间，而寄存器均为16位，
可寻址2^16=64K的存储空间，不能直接寻址1M的存储空间，为此采用分段结构，由16位
段寄存器提供段基址，由不同的寻址方式或寄存器提供16位偏移地址，共同组成20位的物
理地址，寻址1M的存储空间

在实地址方式下存储器如何分段
> 在实地址方式下，将1M字节的存储器划分为4段即代码段、数据段、堆栈段和附加
段。每段包含若干个2^16个字节，（即64K字节单元），并且每个段的首地址是1个可以被16整除的数（即段的起始地址的最低4位为0）。在任意时刻。程序能够很方便地访问4个分段的内容

堆栈的数据结构特点是什么
> 堆栈是CPU内存中一个特定的存储区。堆栈的数据结构特点是“先进后出”，即最后进入堆栈的数据最先从堆栈中弹出

计算机中为什么要设置堆栈
> CPU在处理数据的过程中，有一些中间数据需要进行暂存，同时CPU在调用子程序和进行中断响应的过程中，现场和断点都需要进行保护，为此计算机中设置了一定容量的堆栈

时钟周期
> CPU执行指令的最小时间单位

总线周期
> CPU对存储器或I/O端口完成一次读/写操作所需的时间

指令周期
> CPU执行一条指令所需要的时间

80486微处理器的实地址工作模式的物理地址空间是多大
> 实地址工作模式的物理地址空间为1MB

保护模式的物理地址空间是多大
> 保护模式的物理地址空间为4GB

保护模式虚拟地址空间是多大
> 程序可用的虚拟存储空间为64TB

总线状态码等于010时,将进行哪种总线周期
> 由题意可知M/IO=0表明是对I/O端口操作。D/C=0表明是对数据信号进行操作，W/R=0表明是读操作，所以，当总线状态码等于010时，是对I/O端口进行读数据操作

***
寻址方式

* 立即数寻址
* 寄存器寻址
  > 物理地址=(DS)*16+EA
* 直接寻址
  > 物理地址=(DS)*16+EA
* 寄存器间接寻址
  > 物理地址=(DS)*16+(BX/SI/DI)
  >
  > 物理地址=(SS)*16+(BP)
* 基址寻址
  * 16位寻址
    > EA=(BX/BP)+位移量(8位/16位)
  * 32位寻址
    > EA(基址寄存器)+位移量(8位/32位)
* 间接寻址
  > EA=(间址寄存器)+位移量(8位/32位)
* 比例间接寻址
  > EA=(间址寄存器)*比例因子(2/4/8)+位移量(8位/32位)
* 基址加间接寻址
  > EA=(基址寄存器)+(间址寄存器)
* 基址加比例间址寻址
  > EA=(基址寄存器)+(间址寄存器)*比例因子
* 带位移的基址加间接寻址
  > EA=(基址寄存器)+(间址寄存器)+位移量
* 带位移的基址加比例间址寻址
  > EA=(间址寄存器)*比例因子+(基址寄存器)+位移量
  
80486微处理器六大指令

* 数据传送类指令
  > P72
* 算术运算类指令
  > P81
* 逻辑运算与位移类指令
  > P94
* 串操作类指令
  > P99
* 程序控制类指令
* 处理器控制类指令
  > P110

***

* 代码段
  > 存放指令机器码的存储器区段
* 汇编程序
  > 用汇编语言或高级语言编写的程序
* 源程序
  > 将汇编语言程序翻译成机器码程序的实用程序
* 指令
  > 使计算机执行某种操作的命令
* 伪指令
  > 使汇编程序执行某种操作的命令
* 编译程序
  > 将高级语言的程序翻译成机器码程序的实用程序
* 目标程序
  > 以机器码指令组成的程序
* 助记符
  > 表示计算机执行某种操作的符号
* 标号
  > 指出指令在程序中位置的符号地址
* 变量
  > 指出数据存储单元的符号地址

伪指令数据类型

* DB(8位整数)
* DW(16位整数)
* DD(32位整数或实数)
* DQ(64位整数或实数)
* DT(定义80位(10字节)整数)

段定义伪指令
  > 指示汇编程序如何按段组织程序和使用存储器

```
段名  SEGMENT[定位类型][,组合类型][,字长类型][,类别]
···
段体
···
段名 ENDS
```

段分配伪指令
> 用来完成段的分配，说明当前哪些逻辑段被分别定义为代码段、数据段、堆栈段和附加段

```
ASSUME 段寄存器:段名[,段寄存器,···]
```

段寄存器的装入方法有何不同
> 因为代码段寄存器CS的值是系统初始化时自动设置的，即在模块被装入时由DOS设定，因此，除代码段CS和堆栈段（在组合类型中选择了“STACK”参数）外，其他定义的段寄存器（DS，ES，FS和GS）应由用户在代码段初始处用指令进行段基址的装入。对于堆栈段，还必须要将堆栈栈顶的偏移地址置入堆栈指针SP中

ORG(起始地址)$

DUP(复制)
> 个数 DUP(值)

EQU(等于)

LOOP(循环)

JMP(无条件转移)

PUSH(入栈)

POP(出栈)

```
循环名：代码段
        ···
        LOOP 循环名
```

***

半导体存储器

* 按制造工艺分类
  * 双极型（TTL）
    > 工作速度快，与CPU处于同一量级，但集成度低，功耗大，价格偏高，在微机系统中常用作Cache。
  * 金属氧化型（MOS）
    > 集成度高，功耗低，价格便宜，但速度较双极型器件慢
* 按存取方式分类
  * ROM
    * 掩膜ROM
      > 不可改写
    * 可编程ROM（PROM）
      > 只能写入一次
    * 可擦除可编程ROM（EPROM）
      > 紫外线下易丢失信息
    * 电可擦除可编程（EEPROM/E2PROM）
      > 随机改写，掉电不丢失信息
    * 闪速存储器
      * 串行闪存
        > 节约空间和成本，但存储容量小，速度慢
      * 并行闪存
        > 容量大，速度快
      > 速度快
  * RAM
    * 静态随机存储器（SRAM）
      > 速度快，工作稳定，且不需要刷新电路，使用方便灵活。但由于它所用MOS管较多，致使集成度低，功耗大，成本也高
    * 动态随机存储器（DRAM）
      > 集成度高，功耗低，价格便宜。但由于电容存在漏电现象，电荷会因为漏电而逐渐丢失，因此必须定时对DRAM进行充电（称为刷新）
    * 非易失性随机存储器（NVRAM）
      > 随时读写，自动保护信息

存储器扩展设计的三种基本方法

* 位扩展
* 字扩展
* 字和位扩展

A
> 片内地址

D
> 数据

A
> 三个连接译码器输入端

A B C
> 译码器输入端，输入片选地址

Y0~7
> 译码器输出端，输出片选地址

G2A G2B

M/IO
> I/O端口

CE
> 片选信号

WR
> 写信号

RD
> 读信号

虚拟存储器
> 又称虚拟存储系统，由主存和和辅助存储器共同组成
>
> 将外存和内存资源统一管理，解决了用较小容量的内存运行大容量软件的问题

80486的工作模式

* 实地址模式
* 保护虚地址模式
* 虚拟8086模式

***

80486微处理器支持的五类中断

* 外部中断
  * 不可屏蔽中断（NMI）
    > 无条件被接受
  * 可屏蔽中断（INTR）
    > 受IF标志位影响
* 内部中断
  * 故障
  * 陷阱
  * 异常终止

在实地址模式下，中断地址指针表称为中断向量表，在保护模式称为中断描述表

在实地址模式下，一个中断向量占4字节，在保护模式下占8字节

8259A中，中断类型信号确定ICW2的高五位，输入端确定ICW2的低三位

中断向量表存放中断向量，占1KB，在内存地段第0段的1KB RAM区。在初始化编程时，由系统装入，可以使用传送指令直接装入，也可以使用DOS系统功能调用装入。读出由CPU操作

***

外部设备为什么要通过接口电路和主机系统相连
> 因为外部设备种类繁多，输入信息可能是数字量、模拟量或开关量，而且输入的速
度、电平和数据格式与CPU不同，所以，通常通过接口电路与主机系统相连。

什么叫端口
> 作为中间电路连接I/O设备和CPU（系统总线）

通常有哪几类端口

* 对传送数据提供缓存、隔离和寄存
* 对信号形式和数据的格式进行转换
* 对I/O端口进行寻址
* 与CPU和I/O设备进行联络

计算机为I/O端口编址时通常采用哪几种方法

* I/O与存储器统一编址（存储器映像编址）
* I/O端口和存储器独立编址
  
什么是波特率
> 在串行异步通信中，每秒钟传送二进制数的位数，称为波特率

假设异步传输的1帧信息由1位起始位、7位数据位、1位校验位和1位停止位组成，每秒发送100个字符，计算波特率
> 波特率=100×10=1000bps
